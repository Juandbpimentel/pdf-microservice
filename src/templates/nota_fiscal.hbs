<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: 'Helvetica', Arial, sans-serif; color: #333; padding: 30px; }

        /* --- TRATAMENTO GLOBAL DE OVERFLOW / QUEBRA DE LINHA --- */
        * { box-sizing: border-box; }
        body { overflow-wrap: anywhere; word-wrap: break-word; }
        p, span, div, li, td, th { overflow-wrap: anywhere; word-wrap: break-word; }
        pre { white-space: pre-wrap; overflow-wrap: anywhere; }
        table { width: 100%; table-layout: fixed; }
        img { max-width: 100%; height: auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .card { border: 1px solid #e5e5e5; border-radius: 6px; padding: 12px 14px; }
        .card h3 { margin: 0 0 8px 0; font-size: 14px; color: #0d47a1; }
        .line { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; }
        .line .label { color: #666; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #0d47a1; color: white; padding: 8px; text-align: left; font-size: 12px; }
        td { padding: 8px; border-bottom: 1px solid #eee; font-size: 12px; }
        tr:nth-child(even) td { background: #f8f9fa; }
        .totals { margin-top: 16px; display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
        .total-box { background: #f1f5ff; border: 1px solid #d7e3ff; border-radius: 6px; padding: 10px; }
        .total-box .label { font-size: 12px; color: #555; }
        .total-box .value { font-weight: bold; font-size: 18px; color: #0d47a1; }
        .payment { margin-top: 18px; padding: 12px; border: 1px dashed #b0bec5; border-radius: 6px; }
        .payment strong { color: #0d47a1; }
        .qr { margin-top: 12px; text-align: center; }
        .qr img { width: 140px; height: 140px; }
        .footer-note { margin-top: 18px; font-size: 11px; color: #777; }
    </style>
</head>
<body>
    {{> header_corporativo }}

    <div class="grid">
        <div class="card">
            <h3>Emitente</h3>
            {{#each emitente}}
            <div class="line"><span class="label">{{label}}</span><span>{{valor}}</span></div>
            {{/each}}
        </div>
        <div class="card">
            <h3>Destinatário</h3>
            {{#each destinatario}}
            <div class="line"><span class="label">{{label}}</span><span>{{valor}}</span></div>
            {{/each}}
        </div>
    </div>

    <div class="card">
        <h3>Itens</h3>
        <table>
            <thead>
                <tr>
                    <th>Descrição</th>
                    <th>Qtd</th>
                    <th>Unitário</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {{#each itens}}
                <tr>
                    <td>{{descricao}}</td>
                    <td>{{quantidade}}</td>
                    <td>{{valorUnitario}}</td>
                    <td>{{subtotal}}</td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>

    <div class="totals">
        <div class="total-box">
            <div class="label">Subtotal</div>
            <div class="value">{{totais.subtotal}}</div>
        </div>
        {{#if totais.desconto}}
        <div class="total-box">
            <div class="label">Desconto</div>
            <div class="value">- {{totais.desconto}}</div>
        </div>
        {{/if}}
        {{#if totais.frete}}
        <div class="total-box">
            <div class="label">Frete</div>
            <div class="value">{{totais.frete}}</div>
        </div>
        {{/if}}
        {{#if totais.impostos}}
        <div class="total-box">
            <div class="label">Impostos</div>
            <div class="value">{{totais.impostos}}</div>
        </div>
        {{/if}}
        <div class="total-box">
            <div class="label">Total</div>
            <div class="value">{{totais.total}}</div>
        </div>
    </div>

    <div class="payment">
        <div><strong>Forma de pagamento:</strong> {{pagamento.forma}}</div>
        {{#if pagamento.vencimento}}<div><strong>Vencimento:</strong> {{pagamento.vencimento}}</div>{{/if}}
        {{#if pagamento.status}}<div><strong>Status:</strong> {{pagamento.status}}</div>{{/if}}
        {{#if pagamento.pixCodigo}}
            <div class="qr">
                {{#if pagamento.pixQrCodeDataUrl}}
                    <img src="{{pagamento.pixQrCodeDataUrl}}" alt="QR Code" />
                {{/if}}
                <div style="font-size: 11px; color: #555; word-break: break-all; margin-top: 8px;">{{pagamento.pixCodigo}}</div>
            </div>
        {{/if}}
    </div>

    <div class="footer-note">
        {{#if observacoes}}
            <div><strong>Observações:</strong> {{observacoes}}</div>
        {{/if}}
        <div>Documento gerado em {{dataAtual}}.</div>
    </div>
</body>
</html>
